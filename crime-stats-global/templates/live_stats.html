<!DOCTYPE html>
<html>
<head>
  <title>Live Homicide Data</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #121212;
      color: #e0e0e0;
    }

    h1 {
      text-align: center;
      color: #ffffff;
    }

    select {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      background: #1e1e1e;
      color: #ffffff;
      border: 1px solid #444;
      border-radius: 5px;
    }

    .timestamp, .disclaimer {
      text-align: center;
      color: #bbbbbb;
    }

    .disclaimer {
      font-size: 0.95rem;
      margin-top: 15px;
      max-width: 750px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>üåê Live Homicide Rate (per 100k people)</h1>

  <div style="text-align:center;">
    <form method="get" action="/live">
      <label for="country">Select Country:</label>
      <select name="country" id="country" onchange="this.form.submit()">
        {% for code, name in countries.items() %}
          <option value="{{ code }}" {% if code == selected_country %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </form>
  </div>

  <p class="timestamp">üïí Data last fetched: <strong>{{ timestamp }}</strong></p>
   <p class="disclaimer">
    üìå <strong>Note:</strong> Intentional Homicide rate is fetched annually from the World Bank API (per 100k people). 
    Other metrics (like corruption, firearms trafficking, sexual crime) are based on the cleaned dataset (2019‚Äì2024) and are not live.
  </p>

  <canvas id="homicideChart" width="900" height="400"></canvas>

  <script>
    const data = {{ chart | tojson }};
    const ctx = document.getElementById('homicideChart').getContext('2d');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.years,
        datasets: [{
          label: 'Homicide Rate',
          data: data.values,
          borderColor: 'rgba(255, 99, 132, 1)',
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderWidth: 2,
          fill: true
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: '#e0e0e0' } }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Rate per 100,000',
              color: '#e0e0e0'
            },
            ticks: { color: '#e0e0e0' }
          },
          x: {
            title: {
              display: true,
              text: 'Year',
              color: '#e0e0e0'
            },
            ticks: { color: '#e0e0e0' }
          }
        }
      }
    });
  </script>

  <hr style="margin:40px 0; border-color:#333;">

<h1>üö® Live Crime News ‚Äì Hyderabad</h1>
<p style="text-align:center; color:#bbbbbb;">
Near real-time crime-related updates from verified news sources.
</p>

<div id="news-container">Loading...</div>

<script>
fetch('/api/hyderabad-crime-news')
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById('news-container');
    container.innerHTML = "";

    if (!data.articles || data.articles.length === 0) {
      container.innerHTML = "<p>No recent crime news found.</p>";
      return;
    }

    data.articles.forEach(item => {
      const div = document.createElement('div');
      div.style.background = "#1f1f1f";
      div.style.padding = "15px";
      div.style.marginBottom = "15px";
      div.style.borderRadius = "8px";
      div.style.borderLeft = "4px solid #007bff";

      div.innerHTML = `
        <h3>${item.title}</h3>
        <p>${item.description || ""}</p>
        <small>${item.source} ‚Ä¢ ${new Date(item.published_at).toLocaleString()}</small><br>
        <a href="${item.url}" target="_blank" style="color:#4da3ff;">Read full article</a>
      `;
      container.appendChild(div);
    });
  })
  .catch(() => {
    document.getElementById('news-container').innerHTML =
      "<p>Error loading live data.</p>";
  });
</script>
